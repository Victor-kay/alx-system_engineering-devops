#!/usr/bin/env bash
# Fixes a web server to run Nginx as the nginx user listening on port 8080.

# Backup configuration files
cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.bak
cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak

# Update Nginx user and port in configuration files
sed -i "s/#user www-data/user nginx/" /etc/nginx/nginx.conf
sed -i "s/80/8080/g" /etc/nginx/sites-available/default

# Set appropriate permissions on the configuration files
chmod 644 /etc/nginx/nginx.conf

# Check if Apache is running and stop it
if pgrep apache2 > /dev/null; then
    sudo service apache2 stop
fi

# Start Nginx service using systemctl (or service depending on your system)
sudo systemctl start nginx

# Display status for verification
sudo systemctl status nginx
