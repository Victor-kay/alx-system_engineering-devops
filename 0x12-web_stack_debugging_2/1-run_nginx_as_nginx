#!/usr/bin/env bash
# A BASH Script that runs Nginx web server as nginx and configures Nginx to listen on port 8080

# Stop Apache2 if running
pkill apache2

# Update Nginx configuration to listen on port 8080
sed -i 's/80/8080/g' /etc/nginx/sites-available/default

# Change permissions for nginx.conf
chmod 644 /etc/nginx/nginx.conf

# Restart Nginx service as the nginx user
sudo -u nginx service nginx restart

# Check if Nginx is running as the nginx user
if ps aux | grep -q "[n]ginx: master process"; then
    echo "Nginx is running as the nginx user."
else
    echo "Error: Nginx is not running as the nginx user."
fi

# Check if Nginx is listening on all active IPs on port 8080
nc -z 0 8080
if [ $? -eq 0 ]; then
    echo "Nginx is listening on all active IPs on port 8080."
else
    echo "Error: Nginx is not listening on port 8080."
fi
